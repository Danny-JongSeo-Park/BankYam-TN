<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tn.bankYam.mapper.AccountyMapper">
    <resultMap id="membery" type="Membery">
        <id property="mb_seq" column="mb_seq"/>
        <id property="mb_email" column="mb_email"/>
        <id property="mb_pwd" column="mb_pwd"/>
        <id property="mb_name" column="mb_name"/>
        <id property="mb_addr" column="mb_addr"/>
        <id property="mb_phone" column="mb_phone"/>
        <id property="mb_job" column="mb_job"/>
        <id property="mb_salary" column="mb_salary"/>
        <id property="mb_credit" column="mb_credit"/>
        <id property="mb_imagepath" column="mb_imagepath"/>
        <id property="mb_rdate" column="mb_rdate"/>
        <id property="mb_wdate" column="mb_wdate"/>
    </resultMap>

    <resultMap id="product" type="Product">
        <id property="pd_seq" column="pd_seq"/>
        <id property="pd_type" column="pd_type"/>
        <id property="pd_name" column="pd_name"/>
        <id property="pd_rate" column="pd_rate"/>
        <id property="pd_rdate" column="pd_rdate"/>
        <id property="pd_xdate" column="pd_xdate"/>
    </resultMap>

    <resultMap id="accounty" type="Accounty">
        <id property="ac_seq" column="ac_seq"/>
        <id property="ac_pwd" column="ac_pwd"/>
        <id property="ac_mb_seq" column="ac_mb_seq"/>
        <id property="ac_balance" column="ac_balance"/>
        <id property="ac_name" column="ac_name"/>
        <id property="ac_main" column="ac_main"/>
        <id property="ac_status" column="ac_status"/>
        <id property="ac_pd_seq" column="ac_pd_seq"/>
        <id property="ac_rdate" column="ac_rdate"/>
        <id property="ac_udate" column="ac_udate"/>
        <id property="ac_xdate" column="ac_xdate"/>
        <collection property="membery" resultMap="membery"/>
        <collection property="product" resultMap="product"/>
    </resultMap>

    <select id="checkAccnum" resultType="Accounty" parameterType="long">
        SELECT AC_SEQ FROM ACCOUNTY A
        JOIN MEMBERY M
        ON A.AC_MB_SEQ = M.MB_SEQ
        WHERE M.MB_SEQ = #{mb_seq}
    </select>

    <select id="checkPwd" resultType="Accounty" parameterType="String">
        SELECT AC_PWD FROM ACCOUNTY WHERE AC_PWD=#{ac_pwd}
    </select>

    <select id="checkStatus" resultType="String" parameterType="String">
        SELECT AC_STATUS FROM ACCOUNTY WHERE AC_STATUS=#{ac_status}
    </select>

    <select id="checkPd" resultType="String" parameterType="long">
        SELECT AC_PD_SEQ FROM ACCOUNTY A JOIN PRODUCT P ON A.AC_PD_SEQ=P.PD_SEQ
    </select>

    <update id="transfer" parameterType="Accounty">
        UPDATE ACCOUNTY SET AC_BALANCE=AC_BALANCE + #{ac_balance}
        WHERE AC_SEQ=#{ac_seq}
    </update>
    <select id="findAccByMemberId" parameterType="long" resultMap="accounty">
        SELECT * FROM ACCOUNTY A JOIN PRODUCT P ON A.AC_PD_SEQ = P.PD_SEQ JOIN MEMBERY M ON A.AC_MB_SEQ = M.MB_SEQ WHERE A.AC_MB_SEQ = #{mb_seq} ORDER BY DECODE(AC_MAIN, 'ì£¼', 1)
    </select>
    <select id="findPdBySeq" parameterType="long" resultMap="product">
        SELECT * FROM PRODUCT WHERE PD_SEQ=#{pd_seq};
    </select>
</mapper>